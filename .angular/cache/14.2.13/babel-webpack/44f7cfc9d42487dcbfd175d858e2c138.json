{"ast":null,"code":"import _regeneratorRuntime from \"/Users/loich/Dev/Repos/playlistify/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _classCallCheck from \"/Users/loich/Dev/Repos/playlistify/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/loich/Dev/Repos/playlistify/node_modules/@babel/runtime/helpers/esm/createClass.js\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { Subject } from 'rxjs';\nimport { UserService } from '../../../services/spotify/user.service';\nimport { AlbumService } from '../../../services/local/album.service';\nimport { SpotifyApiService } from '../../../services/spotify/spotifyApi.service';\nimport { MyCalendar } from '../../../shared/myCalendar';\nimport { AlbumsModalComponent } from '../albums-modal/albums-modal.component';\nimport { switchMap, distinctUntilChanged, debounceTime } from 'rxjs/operators';\nimport { FormControl, FormGroup, Validators } from '@angular/forms';\nimport { AlbumEditComponent } from '../album-edit/album-edit.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../services/local/album.service\";\nimport * as i2 from \"../../../services/spotify/user.service\";\nimport * as i3 from \"../../../services/spotify/spotifyApi.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nimport * as i6 from \"ngx-bootstrap/pagination\";\nimport * as i7 from \"ngx-bootstrap/tabs\";\nimport * as i8 from \"ngx-bootstrap/modal\";\n\nfunction AlbumListComponent_div_50_img_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 54);\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"src\", album_r2.spotify.cover, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_template_14_img_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 56);\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵproperty(\"src\", album_r2.sputnikMusic.imagePath, i0.ɵɵsanitizeUrl)(\"alt\", album_r2.albumName);\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_template_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, AlbumListComponent_div_50_ng_template_14_img_0_Template, 1, 2, \"img\", 55);\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n\n    var _r7 = i0.ɵɵreference(17);\n\n    i0.ɵɵproperty(\"ngIf\", album_r2.sputnikMusic)(\"ngIfElse\", _r7);\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_template_16_img_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 56);\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵproperty(\"src\", album_r2.heavyBIsH.imagePath, i0.ɵɵsanitizeUrl)(\"alt\", album_r2.albumName);\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_template_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, AlbumListComponent_div_50_ng_template_16_img_0_Template, 1, 2, \"img\", 55);\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n\n    var _r9 = i0.ɵɵreference(19);\n\n    i0.ɵɵproperty(\"ngIf\", album_r2.heavyBIsH)(\"ngIfElse\", _r9);\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_template_18_img_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 56);\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵproperty(\"src\", album_r2.yourLastRites.imagePath, i0.ɵɵsanitizeUrl)(\"alt\", album_r2.albumName);\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_template_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtemplate(0, AlbumListComponent_div_50_ng_template_18_img_0_Template, 1, 2, \"img\", 57);\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵproperty(\"ngIf\", album_r2.yourLastRites);\n  }\n}\n\nfunction AlbumListComponent_div_50_p_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 58);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Release Date: \", album_r2.spotify.release_date, \"\");\n  }\n}\n\nfunction AlbumListComponent_div_50_p_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 58);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Tracks: \", album_r2.spotify.total_tracks, \"\");\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_template_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 58);\n    i0.ɵɵtext(1, \"No information. Please search on Spotify or try to add to a playlist\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AlbumListComponent_div_50_tab_27_p_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 58);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Number of user rating: \", album_r2.sputnikMusic.numberOfUserRatings, \"\");\n  }\n}\n\nfunction AlbumListComponent_div_50_tab_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tab\", 59)(1, \"p\", 58);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, AlbumListComponent_div_50_tab_27_p_3_Template, 2, 1, \"p\", 44);\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\")(7, \"a\", 60);\n    i0.ɵɵtext(8, \"Consulter sur Sputnik Music\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    var ctx_r35 = i0.ɵɵnextContext();\n    var album_r2 = ctx_r35.$implicit;\n    var i_r3 = ctx_r35.index;\n    var ctx_r15 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Sputnik rating: \", album_r2.sputnikMusic.note, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", album_r2.sputnikMusic.numberOfUserRatings);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Release Date: \", ctx_r15.getDate(i_r3, 0), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate1(\"href\", \"https://www.sputnikmusic.com/album/\", album_r2.sputnikMusic.id, \"/\", i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction AlbumListComponent_div_50_tab_28_p_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 58);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext(2).$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Sources: \", album_r2.heavyBIsH.sources, \"\");\n  }\n}\n\nfunction AlbumListComponent_div_50_tab_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tab\", 61);\n    i0.ɵɵtemplate(1, AlbumListComponent_div_50_tab_28_p_1_Template, 2, 1, \"p\", 44);\n    i0.ɵɵelementStart(2, \"p\", 58);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\")(5, \"a\", 60);\n    i0.ɵɵtext(6, \"Consulter sur HBIH\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    var ctx_r38 = i0.ɵɵnextContext();\n    var album_r2 = ctx_r38.$implicit;\n    var i_r3 = ctx_r38.index;\n    var ctx_r16 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", album_r2.heavyBIsH.sources);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Date: \", ctx_r16.getDate(i_r3, 1), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"href\", album_r2.heavyBIsH.reviewLink, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction AlbumListComponent_div_50_tab_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tab\", 62)(1, \"p\", 58);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"p\")(4, \"a\", 60);\n    i0.ɵɵtext(5, \"Consulter sur Your Last Rites\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    var ctx_r39 = i0.ɵɵnextContext();\n    var i_r3 = ctx_r39.index;\n    var album_r2 = ctx_r39.$implicit;\n    var ctx_r17 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Release Date: \", ctx_r17.getDate(i_r3, 2), \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵpropertyInterpolate(\"href\", album_r2.yourLastRites.reviewLink, i0.ɵɵsanitizeUrl);\n  }\n}\n\nfunction AlbumListComponent_div_50_span_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" Sorry ! No result found\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction AlbumListComponent_div_50_p_35_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Album added to playlist \", album_r2.addedToPlaylist.name, \" \");\n  }\n}\n\nfunction AlbumListComponent_div_50_ng_container_37_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r43 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"button\", 63);\n    i0.ɵɵlistener(\"click\", function AlbumListComponent_div_50_ng_container_37_Template_button_click_3_listener() {\n      i0.ɵɵrestoreView(_r43);\n      var i_r3 = i0.ɵɵnextContext().index;\n      var ctx_r41 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r41.openModalWithComponent(i_r3));\n    });\n    i0.ɵɵtext(4, \"Select Record\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    var album_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", album_r2.spotifySearchResults.length, \" results found! Please select the right one\");\n  }\n}\n\nfunction AlbumListComponent_div_50_Template(rf, ctx) {\n  if (rf & 1) {\n    var _r46 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\", 29)(1, \"div\", 30)(2, \"div\", 31)(3, \"div\", 7)(4, \"div\", 32)(5, \"h4\", 33);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 34)(8, \"strong\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(10, \"div\", 35)(11, \"button\", 36);\n    i0.ɵɵlistener(\"click\", function AlbumListComponent_div_50_Template_button_click_11_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r46);\n      var i_r3 = restoredCtx.index;\n      var ctx_r45 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r45.editReleaseModal(i_r3));\n    });\n    i0.ɵɵelement(12, \"i\", 37);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(13, AlbumListComponent_div_50_img_13_Template, 1, 1, \"img\", 38);\n    i0.ɵɵtemplate(14, AlbumListComponent_div_50_ng_template_14_Template, 1, 2, \"ng-template\", null, 39, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵtemplate(16, AlbumListComponent_div_50_ng_template_16_Template, 1, 2, \"ng-template\", null, 40, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵtemplate(18, AlbumListComponent_div_50_ng_template_18_Template, 1, 1, \"ng-template\", null, 41, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementStart(20, \"div\", 42)(21, \"tabset\")(22, \"tab\", 43);\n    i0.ɵɵtemplate(23, AlbumListComponent_div_50_p_23_Template, 2, 1, \"p\", 44);\n    i0.ɵɵtemplate(24, AlbumListComponent_div_50_p_24_Template, 2, 1, \"p\", 45);\n    i0.ɵɵtemplate(25, AlbumListComponent_div_50_ng_template_25_Template, 2, 0, \"ng-template\", null, 46, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(27, AlbumListComponent_div_50_tab_27_Template, 9, 4, \"tab\", 47);\n    i0.ɵɵtemplate(28, AlbumListComponent_div_50_tab_28_Template, 7, 3, \"tab\", 48);\n    i0.ɵɵtemplate(29, AlbumListComponent_div_50_tab_29_Template, 6, 2, \"tab\", 49);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(30, \"div\", 50)(31, \"button\", 51);\n    i0.ɵɵlistener(\"click\", function AlbumListComponent_div_50_Template_button_click_31_listener() {\n      var restoredCtx = i0.ɵɵrestoreView(_r46);\n      var i_r3 = restoredCtx.index;\n      var ctx_r47 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r47.addToPlaylist(i_r3));\n    });\n    i0.ɵɵelement(32, \"i\", 52);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(33, \"p\");\n    i0.ɵɵtemplate(34, AlbumListComponent_div_50_span_34_Template, 2, 0, \"span\", 53);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(35, AlbumListComponent_div_50_p_35_Template, 2, 1, \"p\", 53);\n    i0.ɵɵelement(36, \"p\");\n    i0.ɵɵtemplate(37, AlbumListComponent_div_50_ng_container_37_Template, 5, 1, \"ng-container\", 53);\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    var album_r2 = ctx.$implicit;\n\n    var _r5 = i0.ɵɵreference(15);\n\n    var _r13 = i0.ɵɵreference(26);\n\n    var ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(album_r2.artistName);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(album_r2.albumName);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"id\", ctx_r1.getUserService().isLoggedIn ? \"btn-edit-release\" : \"btn-edit-release-disabled\")(\"disabled\", !ctx_r1.getUserService().isLoggedIn);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", album_r2.spotify && album_r2.spotify.cover)(\"ngIfElse\", _r5);\n    i0.ɵɵadvance(10);\n    i0.ɵɵproperty(\"ngIf\", album_r2.spotify);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", album_r2.spotify)(\"ngIfElse\", _r13);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", album_r2.sputnikMusic);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", album_r2.heavyBIsH);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", album_r2.yourLastRites);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.getUserService().isLoggedIn);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"id\", ctx_r1.getUserService().isLoggedIn ? \"icon-add-release\" : \"icon-add-release-disable\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", album_r2.searchedOnSpotify && album_r2.spotifySearchResults.length === 0 && !album_r2.spotify);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", album_r2.addedToPlaylist);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", album_r2.searchedOnSpotify && album_r2.spotifySearchResults.length > 1);\n  }\n}\n\nexport var AlbumListComponent = /*#__PURE__*/(function () {\n  var AlbumListComponent = /*#__PURE__*/function () {\n    function AlbumListComponent(albumsService, userService, spotifyApiService, modalService) {\n      var _this = this;\n\n      _classCallCheck(this, AlbumListComponent);\n\n      this.albumsService = albumsService;\n      this.userService = userService;\n      this.spotifyApiService = spotifyApiService;\n      this.modalService = modalService;\n      this.searchForm = new FormGroup({\n        search: new FormControl('', Validators.required),\n        scope: new FormControl('all', Validators.required),\n        sources: new FormControl('allSources', Validators.required)\n      });\n      this.searchReq = new Subject();\n      this.maxSize = 5;\n      this.numPages = 0;\n      this.itemsPerPage = 20; // console.log('CONSTRUCTOR');\n\n      this.albumSubscription = albumsService.albumChanged.subscribe(function (albumChanged) {\n        _this.albumsList[albumChanged.index] = albumChanged.album;\n      });\n      this.userSubscription = userService.userChanged.subscribe(function () {\n        _this.searchPlaylistifiedAlbums();\n      });\n    } //trigger when when user types in searchbar\n\n\n    _createClass(AlbumListComponent, [{\n      key: \"searchEvent\",\n      value: function searchEvent() {\n        var searchRequestObj = {\n          searchData: this.searchForm.get('search').value,\n          searchScope: this.searchForm.get('scope').value,\n          searchSources: this.searchForm.get('sources').value\n        }; // console.log(searchRequestObj);\n        //see ngOnInit\n\n        this.searchReq.next(searchRequestObj);\n      }\n    }, {\n      key: \"getUserService\",\n      value: function getUserService() {\n        return this.userService;\n      }\n    }, {\n      key: \"ngOnInit\",\n      value: function ngOnInit() {\n        // console.log('ON INIT');\n        this.getAlbums(1, this.itemsPerPage); //search logic\n\n        this.search();\n      } //search each time the content of the search bar has changed\n\n    }, {\n      key: \"search\",\n      value: function search() {\n        var _this2 = this;\n\n        this.searchReq.pipe( // wait 300ms after each keystroke before considering the term\n        debounceTime(300), // ignore new term if same as previous term\n        distinctUntilChanged(), // switch to new search observable each time the term changes\n        switchMap(function (value) {\n          _this2.searchMode = true;\n          _this2.currentPage = 1;\n          return _this2.sendSearhReq(value.searchData, value.searchScope, value.searchSources, _this2.currentPage, _this2.itemsPerPage);\n        })).subscribe(function (albumsListI) {\n          // console.log(albumsListI);\n          if (!_this2.isEmptyObject(albumsListI)) {\n            // console.log(\"found results\");\n            _this2.responseToAlbumList(albumsListI);\n          } else {\n            // console.log(\"Display list\");\n            _this2.searchMode = false;\n            _this2.currentPage = 1;\n\n            _this2.getAlbums(_this2.currentPage, _this2.itemsPerPage);\n          }\n        });\n      }\n    }, {\n      key: \"sendSearhReq\",\n      value: function sendSearhReq(searchData, searchScope, searchSources, page, resultLimit) {\n        return this.albumsService.searchAlbum(searchData, searchScope, searchSources, page, resultLimit);\n      }\n    }, {\n      key: \"responseToAlbumList\",\n      value: function responseToAlbumList(_albumsList) {\n        // console.log(_albumsList);\n        this.albumsList = _albumsList.albumsList;\n        this.currentPage = _albumsList.currentPage;\n        this.totalNumberOfPages = _albumsList.totalNumberOfPages;\n        this.totalNumberOfAlbums = _albumsList.totalNumberOfAlbums;\n        this.searchPlaylistifiedAlbums();\n      }\n    }, {\n      key: \"isEmptyObject\",\n      value: function isEmptyObject(obj) {\n        return !Object.keys(obj).length;\n      }\n    }, {\n      key: \"getAlbums\",\n      value: function getAlbums(_page, _itemsPerPage) {\n        var _this3 = this;\n\n        this.albumsService.getAlbums(_page, _itemsPerPage).subscribe(function (albumsListI) {\n          _this3.responseToAlbumList(albumsListI);\n        });\n      }\n    }, {\n      key: \"pageChanged\",\n      value: function pageChanged(event) {\n        var _this4 = this;\n\n        if (this.searchMode) {\n          var _searchReqObj = {\n            searchData: this.searchForm.get('search').value,\n            searchScope: this.searchForm.get('scope').value,\n            searchSources: this.searchForm.get('sources').value\n          };\n          this.sendSearhReq(_searchReqObj.searchData, _searchReqObj.searchScope, _searchReqObj.searchSources, event.page, event.itemsPerPage).subscribe(function (albumsListI) {\n            // console.log(albumsListI);\n            if (!_this4.isEmptyObject(albumsListI)) {\n              // console.log(\"found results\");\n              _this4.responseToAlbumList(albumsListI);\n            } else {\n              // console.log(\"Display list\");\n              _this4.searchMode = false;\n              _this4.currentPage = 1;\n\n              _this4.getAlbums(_this4.currentPage, _this4.itemsPerPage);\n            }\n          });\n        } else {\n          this.getAlbums(event.page, event.itemsPerPage);\n        }\n\n        window.scroll(0, 0);\n      }\n    }, {\n      key: \"openModalWithComponent\",\n      value: function openModalWithComponent(albumIndex) {\n        var _this5 = this;\n\n        // retrieve albumsFound and pass them to the modal\n        var albumToUpdate = this.albumsList[albumIndex]; // console.log('AlbumToUpdate: ' + JSON.stringify(albumToUpdate));\n\n        var initialState = {\n          albumsFound: albumToUpdate.spotifySearchResults,\n          title: albumToUpdate.albumName,\n          artist: albumToUpdate.artistName\n        };\n        this.bsModalRef = this.modalService.show(AlbumsModalComponent, {\n          initialState: initialState\n        });\n        this.bsModalRef.content.albumIndex = albumIndex;\n        this.bsModalRef.content.onChosenAlbum.subscribe(function (info) {\n          albumToUpdate.spotify = albumToUpdate.spotifySearchResults[info.resultIndex];\n          albumToUpdate.searchedOnSpotify = true;\n          albumToUpdate.spotifySearchResults = [];\n\n          _this5.albumsService.updateAlbumOnDB(albumToUpdate).subscribe(function (albumUpdated) {\n            albumUpdated.searchedOnSpotify = true;\n            albumUpdated.spotifySearchResults = [];\n\n            _this5.updateAlbum(albumIndex, albumUpdated);\n\n            _this5.addToPlaylist(albumIndex);\n          });\n        });\n      }\n    }, {\n      key: \"editReleaseModal\",\n      value: function editReleaseModal(albumIndex) {\n        var _this6 = this;\n\n        // retrieve albumsFound and pass them to the modal\n        var albumToEdit = this.albumsList[albumIndex]; // console.log('AlbumToUpdate: ' + JSON.stringify(albumToUpdate));\n\n        var initialState = {\n          album: albumToEdit,\n          updated: false\n        };\n        this.bsModalRef = this.modalService.show(AlbumEditComponent, {\n          initialState: initialState\n        });\n        this.bsModalRef.content.onUpdateAlbum.subscribe(function (album) {\n          _this6.albumsService.updateAlbumOnDB(album.albumToUpdate).subscribe({\n            next: function next(albumUpdated) {\n              // albumUpdated.searchedOnSpotify = true;\n              // albumUpdated.spotifySearchResults = [];\n              _this6.updateAlbum(albumIndex, albumUpdated); // this.addToPlaylist(albumIndex);\n\n\n              _this6.bsModalRef.content.updated = true;\n              _this6.bsModalRef.content._alert = _this6.bsModalRef.content.defaultAlerts[0];\n            },\n            error: function error(e) {\n              _this6.bsModalRef.content.updated = true;\n              _this6.bsModalRef.content._alert = _this6.bsModalRef.content.defaultAlerts[1];\n              console.log(e);\n            }\n          }); // this.bsModalRef.content.albumIndex = albumIndex;\n\n        });\n      }\n    }, {\n      key: \"getDate\",\n      value: function getDate(i, s) {\n        if (s === 0) {\n          return MyCalendar.month[+this.albumsList[i].sputnikMusic.releaseDate.month - 1] + ' ' + this.albumsList[i].sputnikMusic.releaseDate.year;\n        } else if (s === 1) {\n          return MyCalendar.month[+this.albumsList[i].heavyBIsH.releaseDate.month - 1] + ' ' + this.albumsList[i].heavyBIsH.releaseDate.year;\n        } else if (s === 2) {\n          return MyCalendar.month[+this.albumsList[i].yourLastRites.releaseDate.month - 1] + ' ' + this.albumsList[i].yourLastRites.releaseDate.year;\n        }\n      }\n    }, {\n      key: \"addToPlaylist\",\n      value: function addToPlaylist(index) {\n        return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n          var album, spotifyAlbumId, albumPlaylistToSave;\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                // album not found or search on spotify preiously\n                album = this.albumsList[index];\n\n                if (album.searchedOnSpotify) {\n                  _context.next = 4;\n                  break;\n                }\n\n                _context.next = 4;\n                return this.searchAlbumOnSpotify(index);\n\n              case 4:\n                if (!(album.searchedOnSpotify && album.spotify)) {\n                  _context.next = 11;\n                  break;\n                }\n\n                spotifyAlbumId = this.albumsList[index].spotify.id;\n                _context.next = 8;\n                return this.spotifyApiService.addAlbumToPlaylist(spotifyAlbumId, this.userService.getSelectedPlaylistId());\n\n              case 8:\n                albumPlaylistToSave = {\n                  idSpotify: this.userService.getSelectedPlaylistId(),\n                  name: this.userService.getSelectedPlaylistName(),\n                  userId: this.userService.getUserDbId(),\n                  albumId: this.albumsList[index]._id\n                };\n                this.albumsList[index].addedToPlaylist = albumPlaylistToSave;\n                this.savePlaylist(this.albumsList[index].addedToPlaylist);\n\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee, this);\n        }));\n      }\n    }, {\n      key: \"savePlaylist\",\n      value: function savePlaylist(_savePlaylist) {\n        this.albumsService.savePlaylistAlbum(_savePlaylist).subscribe();\n      }\n    }, {\n      key: \"searchPlaylistifiedAlbums\",\n      value: function searchPlaylistifiedAlbums() {\n        var _this7 = this;\n\n        //if user is authentified\n        // search if albums of the page have already been added to a playlist\n        if (this.userService.isAuthenticated()) {\n          this.albumsService.searchPlaylistifiedAlbums(this.albumsList, this.userService.getUserDbId()).subscribe(function (playlists) {\n            if (playlists != null) {\n              playlists.forEach(function (playlist) {\n                _this7.albumsList.forEach(function (album, index) {\n                  if (playlist.albumId === album._id) {\n                    album.addedToPlaylist = playlist;\n\n                    _this7.updateAlbum(index, album);\n                  }\n                });\n              });\n            }\n          });\n        }\n      }\n    }, {\n      key: \"searchAlbumOnSpotify\",\n      value: function searchAlbumOnSpotify(index) {\n        var _this8 = this;\n\n        return new Promise(function (resolve) {\n          var album = _this8.albumsList[index];\n\n          _this8.spotifyApiService.searchItem('album:' + album.albumName + ' artist:' + album.artistName, 'album').subscribe(function (foundAlbums) {\n            if (foundAlbums.length > 0) {\n              album.searchedOnSpotify = true;\n\n              if (foundAlbums.length === 1) {\n                // if only one result, save the spotify album id for later\n                // than add album to the selected playlist\n                album.spotify = foundAlbums[0];\n\n                _this8.albumsService.updateAlbumOnDB(album).subscribe(function (albumUpdated) {\n                  albumUpdated.searchedOnSpotify = true;\n                  albumUpdated.spotifySearchResults = [];\n\n                  _this8.updateAlbum(index, albumUpdated); // this.addToPlaylist(index);\n\n                });\n              } else {\n                album.spotifySearchResults = foundAlbums;\n              }\n\n              resolve(true);\n            } else {\n              // no result found for search with album+artist, search with only album\n              _this8.spotifyApiService.searchItem('artist:' + album.artistName, 'album').subscribe(function (foundAlbums2) {\n                if (foundAlbums2.length > 0) {\n                  album.searchedOnSpotify = true;\n\n                  if (foundAlbums2.length === 1) {\n                    album.spotify = foundAlbums2[0];\n\n                    _this8.albumsService.updateAlbumOnDB(album).subscribe(function (albumUpdated) {\n                      albumUpdated.searchedOnSpotify = true;\n                      albumUpdated.spotifySearchResults = [];\n\n                      _this8.updateAlbum(index, albumUpdated); // this.addToPlaylist(index);\n\n                    });\n                  } else {\n                    album.spotifySearchResults = foundAlbums2;\n                  }\n\n                  resolve(true);\n                } else {\n                  album.searchedOnSpotify = true;\n                  resolve(false);\n                }\n              });\n            }\n          }, function (err) {\n            return console.log(err);\n          });\n        });\n      }\n    }, {\n      key: \"updateAlbum\",\n      value: function updateAlbum(index, newAlbum) {\n        // this.albumsList[index] = newAlbum;\n        this.albumsService.updateAlbum(index, newAlbum);\n      }\n    }, {\n      key: \"changedSourceEvent\",\n      value: function changedSourceEvent() {\n        // console.log(\"changedSource\");\n        this.searchEvent();\n      }\n    }]);\n\n    return AlbumListComponent;\n  }();\n\n  AlbumListComponent.ɵfac = function AlbumListComponent_Factory(t) {\n    return new (t || AlbumListComponent)(i0.ɵɵdirectiveInject(i1.AlbumService), i0.ɵɵdirectiveInject(i2.UserService), i0.ɵɵdirectiveInject(i3.SpotifyApiService), i0.ɵɵdirectiveInject(BsModalService));\n  };\n\n  AlbumListComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AlbumListComponent,\n    selectors: [[\"app-album-list\"]],\n    decls: 54,\n    vars: 14,\n    consts: [[3, \"formGroup\"], [1, \"form-group\", \"row\"], [\"for\", \"Search\", 1, \"col-sm-2\", \"col-form-label\"], [1, \"col-sm-10\"], [\"type\", \"text\", \"id\", \"Search\", \"placeholder\", \"Search artists and albums\", \"formControlName\", \"search\", 1, \"form-control\", 3, \"input\"], [\"searchbox\", \"\"], [1, \"form-group\"], [1, \"row\"], [1, \"col-sm\"], [1, \"col-form-label\", \"pt-0\"], [1, \"form-check\"], [\"type\", \"radio\", \"name\", \"scope\", \"id\", \"radioAll\", \"value\", \"all\", \"formControlName\", \"scope\", 1, \"form-check-input\", 3, \"change\"], [\"for\", \"radioAll\", 1, \"form-check-label\"], [\"type\", \"radio\", \"name\", \"scope\", \"id\", \"radioArtists\", \"value\", \"artists\", \"formControlName\", \"scope\", 1, \"form-check-input\", 3, \"change\"], [\"for\", \"radioArtists\", 1, \"form-check-label\"], [\"type\", \"radio\", \"name\", \"scope\", \"id\", \"radioAlbums\", \"value\", \"albums\", \"formControlName\", \"scope\", 1, \"form-check-input\", 3, \"change\"], [\"for\", \"radioAlbums\", 1, \"form-check-label\"], [\"type\", \"radio\", \"name\", \"sources\", \"id\", \"radioAllSources\", \"value\", \"allSources\", \"formControlName\", \"sources\", 1, \"form-check-input\", 3, \"change\"], [\"for\", \"radioAllSources\", 1, \"form-check-label\"], [\"type\", \"radio\", \"name\", \"sources\", \"id\", \"radioSputnikMusicSources\", \"value\", \"sputnikMusic\", \"formControlName\", \"sources\", 1, \"form-check-input\", 3, \"change\"], [\"for\", \"radioSputnikMusicSources\", 1, \"form-check-label\"], [\"type\", \"radio\", \"name\", \"sources\", \"id\", \"radioHBIHSources\", \"value\", \"hbih\", \"formControlName\", \"sources\", 1, \"form-check-input\", 3, \"change\"], [\"for\", \"radioHBIHSources\", 1, \"form-check-label\"], [\"type\", \"radio\", \"name\", \"sources\", \"id\", \"radioYLRSources\", \"value\", \"ylr\", \"formControlName\", \"sources\", 1, \"form-check-input\", 3, \"change\"], [\"for\", \"radioYLRSources\", 1, \"form-check-label\"], [1, \"col-xs-12\", \"col-12\"], [1, \"pagination-sm\", 3, \"ngModel\", \"totalItems\", \"itemsPerPage\", \"maxSize\", \"boundaryLinks\", \"rotate\", \"ngModelChange\", \"numPages\", \"pageChanged\"], [\"class\", \"col-sm-6 col-md-4\", 4, \"ngFor\", \"ngForOf\"], [1, \"pagination-sm\", 3, \"ngModel\", \"totalItems\", \"itemsPerPage\", \"maxSize\", \"boundaryLinks\", \"rotate\", \"ngModelChange\"], [1, \"col-sm-6\", \"col-md-4\"], [1, \"card\", \"mb-4\"], [1, \"card-header\"], [1, \"col-md-8\"], [1, \"card-title\"], [1, \"card-subtitle\"], [1, \"col-6\", \"col-md-4\", 2, \"text-align\", \"center\", \"padding-right\", \"0px\"], [1, \"btn\", \"btn-primary\", 3, \"id\", \"disabled\", \"click\"], [1, \"fas\", \"fa-edit\", \"fa-sm\"], [\"class\", \"card-img-top\", \"alt\", \"album.albumName\", 3, \"src\", 4, \"ngIf\", \"ngIfElse\"], [\"sputnikCover\", \"\"], [\"heavyBlogCover\", \"\"], [\"yourLastRitesCover\", \"\"], [1, \"card-body\"], [\"heading\", \"Spotify\"], [\"class\", \"mt-2\", 4, \"ngIf\"], [\"class\", \"mt-2\", 4, \"ngIf\", \"ngIfElse\"], [\"elseBlock\", \"\"], [\"heading\", \"Sputnik Music\", 4, \"ngIf\"], [\"heading\", \"HBIH\", 4, \"ngIf\"], [\"heading\", \"YLR\", 4, \"ngIf\"], [1, \"card-footer\"], [\"id\", \"btn-add-release\", 1, \"mr-1\", 3, \"disabled\", \"click\"], [1, \"fas\", \"fa-plus-circle\", 3, \"id\"], [4, \"ngIf\"], [\"alt\", \"album.albumName\", 1, \"card-img-top\", 3, \"src\"], [\"class\", \"card-img-top\", 3, \"src\", \"alt\", 4, \"ngIf\", \"ngIfElse\"], [1, \"card-img-top\", 3, \"src\", \"alt\"], [\"class\", \"card-img-top\", 3, \"src\", \"alt\", 4, \"ngIf\"], [1, \"mt-2\"], [\"heading\", \"Sputnik Music\"], [\"target\", \"_blank\", 3, \"href\"], [\"heading\", \"HBIH\"], [\"heading\", \"YLR\"], [1, \"btn\", \"btn-primary\", 3, \"click\"]],\n    template: function AlbumListComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"form\", 0)(1, \"div\", 1)(2, \"label\", 2)(3, \"b\");\n        i0.ɵɵtext(4, \"Search\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"div\", 3)(6, \"input\", 4, 5);\n        i0.ɵɵlistener(\"input\", function AlbumListComponent_Template_input_input_6_listener() {\n          return ctx.searchEvent();\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(8, \"fieldset\", 6)(9, \"div\", 7)(10, \"div\", 8)(11, \"legend\", 9)(12, \"b\");\n        i0.ɵɵtext(13, \"Release Type\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(14, \"div\", 10)(15, \"input\", 11);\n        i0.ɵɵlistener(\"change\", function AlbumListComponent_Template_input_change_15_listener() {\n          return ctx.searchEvent();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"label\", 12);\n        i0.ɵɵtext(17, \" All \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(18, \"div\", 10)(19, \"input\", 13);\n        i0.ɵɵlistener(\"change\", function AlbumListComponent_Template_input_change_19_listener() {\n          return ctx.searchEvent();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"label\", 14);\n        i0.ɵɵtext(21, \" Artists \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(22, \"div\", 10)(23, \"input\", 15);\n        i0.ɵɵlistener(\"change\", function AlbumListComponent_Template_input_change_23_listener() {\n          return ctx.searchEvent();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(24, \"label\", 16);\n        i0.ɵɵtext(25, \" Albums \");\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(26, \"div\", 8)(27, \"legend\", 9)(28, \"b\");\n        i0.ɵɵtext(29, \"Sources\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(30, \"div\", 10)(31, \"input\", 17);\n        i0.ɵɵlistener(\"change\", function AlbumListComponent_Template_input_change_31_listener() {\n          return ctx.changedSourceEvent();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"label\", 18);\n        i0.ɵɵtext(33, \" All \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(34, \"div\", 10)(35, \"input\", 19);\n        i0.ɵɵlistener(\"change\", function AlbumListComponent_Template_input_change_35_listener() {\n          return ctx.changedSourceEvent();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(36, \"label\", 20);\n        i0.ɵɵtext(37, \" Sputnik Music \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(38, \"div\", 10)(39, \"input\", 21);\n        i0.ɵɵlistener(\"change\", function AlbumListComponent_Template_input_change_39_listener() {\n          return ctx.changedSourceEvent();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(40, \"label\", 22);\n        i0.ɵɵtext(41, \" Heavy Blog Is Heavy \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(42, \"div\", 10)(43, \"input\", 23);\n        i0.ɵɵlistener(\"change\", function AlbumListComponent_Template_input_change_43_listener() {\n          return ctx.changedSourceEvent();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(44, \"label\", 24);\n        i0.ɵɵtext(45, \" Your Last Rites \");\n        i0.ɵɵelementEnd()()()()()();\n        i0.ɵɵelementStart(46, \"div\", 7)(47, \"div\", 25)(48, \"pagination\", 26);\n        i0.ɵɵlistener(\"ngModelChange\", function AlbumListComponent_Template_pagination_ngModelChange_48_listener($event) {\n          return ctx.currentPage = $event;\n        })(\"numPages\", function AlbumListComponent_Template_pagination_numPages_48_listener($event) {\n          return ctx.numPages = $event;\n        })(\"pageChanged\", function AlbumListComponent_Template_pagination_pageChanged_48_listener($event) {\n          return ctx.pageChanged($event);\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(49, \"div\", 7);\n        i0.ɵɵtemplate(50, AlbumListComponent_div_50_Template, 38, 17, \"div\", 27);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(51, \"div\", 7)(52, \"div\", 25)(53, \"pagination\", 28);\n        i0.ɵɵlistener(\"ngModelChange\", function AlbumListComponent_Template_pagination_ngModelChange_53_listener($event) {\n          return ctx.currentPage = $event;\n        });\n        i0.ɵɵelementEnd()()();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵproperty(\"formGroup\", ctx.searchForm);\n        i0.ɵɵadvance(48);\n        i0.ɵɵproperty(\"ngModel\", ctx.currentPage)(\"totalItems\", ctx.totalNumberOfAlbums)(\"itemsPerPage\", ctx.itemsPerPage)(\"maxSize\", ctx.maxSize)(\"boundaryLinks\", true)(\"rotate\", false);\n        i0.ɵɵadvance(2);\n        i0.ɵɵproperty(\"ngForOf\", ctx.albumsList);\n        i0.ɵɵadvance(3);\n        i0.ɵɵproperty(\"ngModel\", ctx.currentPage)(\"totalItems\", ctx.totalNumberOfAlbums)(\"itemsPerPage\", ctx.itemsPerPage)(\"maxSize\", ctx.maxSize)(\"boundaryLinks\", true)(\"rotate\", false);\n      }\n    },\n    dependencies: [i4.NgForOf, i4.NgIf, i5.ɵNgNoValidate, i5.DefaultValueAccessor, i5.RadioControlValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.NgModel, i5.FormGroupDirective, i5.FormControlName, i6.PaginationComponent, i7.TabDirective, i7.TabsetComponent],\n    styles: [\"#AlbumCover[_ngcontent-%COMP%]{height:300px;width:300px}form[_ngcontent-%COMP%]   .navbar-form[_ngcontent-%COMP%]{padding-top:5px}.nav[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:250px}\"]\n  });\n  return AlbumListComponent;\n})();\n\nfunction complete(complete, arg1, error, arg3) {\n  throw new Error('Function not implemented.');\n}","map":null,"metadata":{},"sourceType":"module"}